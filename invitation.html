<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <link rel="stylesheet" href="styles.css">

        <title>Hello World</title>
        
    </head>

    <body class="text-center">
       

        <h1 style="font-size:100px; padding: 25px" class="display-4" id="name-text"></h1>

        <div class="invitation-content"></div>
        <h3 style="padding: 10px" id="description-text"></h2>
        <h3 style="padding: 10px" id="date-text"></h2>
        <h3 style="padding: 10px" id="time-text"></h2>
        
        <div style="padding: 10px;">
            <h3 id="location-text"></h2>
            <a  style="text-decoration: underline; color:black;"id="google-maps-link" target="_blank" hidden=true>Google Maps Link</a>
        </div>
        
        <div style="padding: 10px; position: absolute; bottom: 10px" class="col-12">
            <button data-toggle="popover" data-trigger="focus" data-content="Copied" style="background: black;" class="btn btn-secondary" onclick="copytoClipBoard()">Copy Sharable Link</button>
        </div>
        <input hidden=true type="text" value="shit World" id="permalink-input">

        <!-- <div class="row">
            <div class="col-4"></div>
            <div class="col-4">
                        <div class="row">
                                <div class="col-10"> 
                                        <input type="email" class="form-control" id="email-sender" placeholder="Send meeting through email">
                                </div>
                                <div class="col-2">
                                        <button type="button"  style="background: black;" class="btn btn-secondary" id="send-button" onclick="sendEmail()">Send</button>
                                </div>
                        </div>
            </div>
            <div class="col-4"></div>
        </div> -->



        
        <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>   

        <script>
             $('[data-toggle="popover"]').popover()


            
             function convertMilitarytoStandard(time) {
                console.log(time)
            
                digits = time.slice(0,2);
                if (parseInt(digits) >= 12) {
                    convertedDigits = parseInt(digits) - 12 ;
                    if (convertedDigits == 0)  {
                        convertedDigits = 12;
                    }

                    return convertedDigits + time.slice(2, time.length) + " p.m.";

                }
                else {
                    if (parseInt(digits) == 0)  {
                        return "12" + time.slice(2, time.length) + " a.m.";

                    }

                    return time + " a.m";
                }
            }

            const urlParams = new URLSearchParams(window.location.search);
            $('#name-text').html(urlParams.get('name')); 
            $('#description-text').html(urlParams.get('description'));
            var time = urlParams.get('time')
            $('#time-text').html(convertMilitarytoStandard(time));
            dateString = urlParams.get('date');
            var options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            date = new Date(dateString);
            $('#date-text').html(date.toLocaleDateString("en-US", options));

            
            var meetingPlace = urlParams.get('location');
            $('#location-text').html(meetingPlace);
            if (meetingPlace.length > 0)  {
                $("#google-maps-link").attr("hidden", false);
                $("#google-maps-link").attr("href", "https://www.google.com/maps/place/" + meetingPlace);
            }

            $("#permalink-input").val(window.location.href);




            function sendEmail () {
                emailAddress = $("#email-sender").val();
                console.log(emailAddress);
                $.ajax ({
                    url: "http://127.0.0.1:5000/email",
                    type: "POST",
                    crossDomain: true,
                    success: function(result) {
                        alert(result);
                    },
                    error: function(xhr, textStatus, errorThrown){
                        alert("An error occured when sending your email");
                    }
                })
            }

            function copytoClipBoard() {
                var copyText = document.getElementById("permalink-input");
                document.getElementById("permalink-input").hidden = false;
                copyText.select();
                document.execCommand("copy");
                document.getElementById("permalink-input").hidden = true;
            }

        </script>

    </body>